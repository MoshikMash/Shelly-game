<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>üëó Style Battle!</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700;800;900&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
:root{
  --p1:#f472b6;--p2:#818cf8;--gold:#fbbf24;--text:#2d1b4e;
  --bg:#fdf4ff;--card:#fff;--soft:#9d7ec0;
}
body{font-family:'Nunito',sans-serif;background:var(--bg);min-height:100vh;overflow-x:hidden;
  background-image:radial-gradient(circle at 15% 20%,#fce7f3 0%,transparent 40%),radial-gradient(circle at 85% 80%,#ede9fe 0%,transparent 40%);}

/* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
.screen{display:none;min-height:100vh;flex-direction:column;align-items:center;padding:1rem;}
.screen.active{display:flex;}

/* ‚îÄ‚îÄ COMMON ‚îÄ‚îÄ */
.logo{font-family:'Fredoka One',cursive;font-size:clamp(2rem,7vw,3rem);
  background:linear-gradient(135deg,var(--p1),var(--p2));-webkit-background-clip:text;
  -webkit-text-fill-color:transparent;background-clip:text;text-align:center;margin-bottom:.3rem;}
.card{background:var(--card);border-radius:1.5rem;padding:1.2rem;
  box-shadow:0 8px 30px rgba(0,0,0,.08);border:2px solid rgba(192,132,252,.15);}
.btn{border:none;border-radius:14px;padding:.7rem 1.2rem;font-family:'Nunito',sans-serif;
  font-weight:800;font-size:1rem;cursor:pointer;transition:all .2s;color:white;}
.btn-primary{background:linear-gradient(135deg,var(--p1),#ec4899);box-shadow:0 4px 14px rgba(244,114,182,.35);}
.btn-secondary{background:linear-gradient(135deg,var(--p2),#6366f1);box-shadow:0 4px 14px rgba(129,140,248,.35);}
.btn-green{background:linear-gradient(135deg,#34d399,#059669);}
.btn-gold{background:linear-gradient(135deg,#fbbf24,#f59e0b);color:#1a0a00;}
.btn:hover{transform:translateY(-2px) scale(1.03);}
.btn:active{transform:scale(.97);}
.conn{position:fixed;top:.5rem;right:.5rem;font-size:.7rem;font-weight:800;
  padding:.2rem .6rem;border-radius:10px;z-index:999;}
.conn.on{background:#dcfce7;color:#15803d;}
.conn.off{background:#fee2e2;color:#b91c1c;}
.conn.wait{background:#fef9c3;color:#92400e;}

/* ‚îÄ‚îÄ HOME ‚îÄ‚îÄ */
#homeScreen{justify-content:center;gap:1rem;}
.home-btns{display:flex;flex-direction:column;gap:.7rem;width:100%;max-width:320px;}
.big-btn{border:none;border-radius:18px;padding:1rem 1.5rem;font-family:'Nunito',sans-serif;
  font-weight:900;font-size:1.05rem;color:white;cursor:pointer;transition:all .2s;
  box-shadow:0 6px 20px rgba(0,0,0,.12);display:flex;align-items:center;gap:.6rem;justify-content:center;}
.big-btn:hover{transform:translateY(-3px) scale(1.02);}

/* ‚îÄ‚îÄ CREATE / JOIN ‚îÄ‚îÄ */
#createScreen,#joinScreen{justify-content:center;}
.modal-card{background:var(--card);border-radius:2rem;padding:2rem;
  box-shadow:0 12px 40px rgba(0,0,0,.1);width:100%;max-width:340px;
  display:flex;flex-direction:column;gap:.9rem;align-items:center;}
.modal-card h2{font-family:'Fredoka One',cursive;font-size:1.6rem;color:var(--p1);}
.room-code{background:linear-gradient(135deg,var(--p1),var(--p2));color:white;
  border-radius:16px;padding:.7rem 1.5rem;font-family:'Fredoka One',cursive;
  font-size:2.6rem;letter-spacing:6px;box-shadow:0 6px 20px rgba(244,114,182,.3);}
.field{width:100%;border:2.5px solid #e9d5ff;border-radius:14px;padding:.65rem 1rem;
  font-family:'Nunito',sans-serif;font-weight:700;font-size:1rem;color:var(--text);
  background:#fdf4ff;outline:none;text-align:center;}
.field:focus{border-color:var(--p1);}
.code-field{font-family:'Fredoka One',cursive;font-size:2rem;letter-spacing:6px;text-transform:uppercase;}
.wait-dots span{animation:bounce 1.2s infinite;display:inline-block;}
.wait-dots span:nth-child(2){animation-delay:.2s;}
.wait-dots span:nth-child(3){animation-delay:.4s;}
@keyframes bounce{0%,80%,100%{transform:translateY(0)}40%{transform:translateY(-7px)}}

/* ‚îÄ‚îÄ THEME SELECT ‚îÄ‚îÄ */
#themeScreen{justify-content:flex-start;padding-top:1rem;}
.theme-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:.7rem;width:100%;max-width:500px;margin-top:.5rem;}
.theme-card{background:var(--card);border-radius:1.2rem;padding:.9rem .7rem;text-align:center;
  cursor:pointer;transition:all .2s;border:3px solid transparent;
  box-shadow:0 4px 14px rgba(0,0,0,.07);}
.theme-card:hover{transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,0,0,.12);}
.theme-card.selected{border-color:var(--p1);background:#fce7f3;}
.theme-card .t-emoji{font-size:2rem;}
.theme-card .t-name{font-weight:800;font-size:.85rem;color:var(--text);margin-top:.3rem;}
.theme-card .t-kw{font-size:.68rem;color:var(--soft);font-weight:600;margin-top:.15rem;}

/* ‚îÄ‚îÄ DRESS-UP ‚îÄ‚îÄ */
#dressScreen{justify-content:flex-start;padding:.5rem .7rem 5rem;}
.dress-top{width:100%;max-width:500px;display:flex;align-items:center;gap:.6rem;margin-bottom:.5rem;}
.theme-pill{flex:1;background:linear-gradient(135deg,var(--p1),var(--p2));border-radius:20px;
  padding:.4rem .9rem;font-family:'Fredoka One',cursive;color:white;font-size:.95rem;text-align:center;}
.timer-box{background:var(--card);border-radius:12px;padding:.35rem .7rem;
  font-family:'Fredoka One',cursive;font-size:1.2rem;color:var(--p1);
  box-shadow:0 2px 8px rgba(0,0,0,.08);min-width:3.5rem;text-align:center;}
.timer-box.urgent{color:#ef4444;animation:pulse .8s ease infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

/* Character stage */
.char-stage{display:flex;justify-content:center;margin-bottom:.5rem;}
.char-stage svg{width:130px;height:220px;overflow:visible;}

/* Category tabs */
.cat-tabs{display:flex;gap:.4rem;width:100%;max-width:500px;margin-bottom:.5rem;overflow-x:auto;scrollbar-width:none;}
.cat-tabs::-webkit-scrollbar{display:none;}
.cat-tab{flex-shrink:0;border:none;border-radius:20px;padding:.35rem .8rem;
  font-family:'Nunito',sans-serif;font-weight:800;font-size:.78rem;cursor:pointer;
  transition:all .2s;background:var(--card);color:var(--soft);border:2px solid #e9d5ff;}
.cat-tab.active{background:var(--p1);color:white;border-color:var(--p1);}

/* Choices grid */
.choices-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem;
  width:100%;max-width:500px;}
.choice-card{background:var(--card);border-radius:1rem;padding:.6rem .4rem;text-align:center;
  cursor:pointer;transition:all .2s;border:2.5px solid #e9d5ff;
  display:flex;flex-direction:column;align-items:center;gap:.25rem;}
.choice-card:hover{border-color:var(--p1);transform:scale(1.04);}
.choice-card.selected{border-color:var(--p1);background:#fce7f3;
  box-shadow:0 4px 14px rgba(244,114,182,.25);}
.choice-card .c-emoji{font-size:1.6rem;}
.choice-card .c-name{font-size:.68rem;font-weight:800;color:var(--text);line-height:1.2;}
.choice-card .c-color{width:16px;height:16px;border-radius:50%;margin:0 auto;border:2px solid rgba(0,0,0,.1);}

/* Custom type input */
.custom-row{display:flex;gap:.4rem;width:100%;max-width:500px;margin-top:.5rem;}
.custom-in{flex:1;border:2.5px solid var(--p1);border-radius:12px;padding:.5rem .7rem;
  font-family:'Nunito',sans-serif;font-weight:700;font-size:.9rem;color:var(--text);
  background:#fdf4ff;outline:none;}
.custom-in::placeholder{color:#f9a8d4;}

/* Ready btn */
.ready-btn-wrap{position:fixed;bottom:1rem;left:50%;transform:translateX(-50%);z-index:50;width:calc(100% - 2rem);max-width:500px;}
.ready-btn{width:100%;padding:.85rem;font-size:1.1rem;border-radius:16px;}

/* ‚îÄ‚îÄ RUNWAY ‚îÄ‚îÄ */
#runwayScreen{justify-content:center;gap:1rem;background:linear-gradient(180deg,#1a0a2e 0%,#2d1b4e 60%,#1a0a2e 100%);}
.runway-wrap{width:100%;max-width:400px;position:relative;overflow:hidden;height:60vh;
  display:flex;align-items:flex-end;justify-content:center;}
.runway-floor{position:absolute;bottom:0;left:0;right:0;height:35%;
  background:linear-gradient(180deg,transparent,rgba(255,255,255,.05));
  border-top:2px solid rgba(255,255,255,.2);}
.runway-lights{position:absolute;bottom:30%;left:0;right:0;display:flex;justify-content:space-around;}
.runway-light{width:8px;height:8px;border-radius:50%;background:#fbbf24;
  box-shadow:0 0 12px #fbbf24;animation:lightBlink 1.5s ease infinite;}
.runway-light:nth-child(2){animation-delay:.3s;}
.runway-light:nth-child(3){animation-delay:.6s;}
.runway-light:nth-child(4){animation-delay:.9s;}
.runway-light:nth-child(5){animation-delay:1.2s;}
@keyframes lightBlink{0%,100%{opacity:1}50%{opacity:.3}}
.runway-char{position:absolute;bottom:30%;left:50%;transform:translateX(-50%);
  animation:walkIn 3s ease forwards;}
@keyframes walkIn{from{bottom:-20%;opacity:0}to{bottom:32%;opacity:1}}
.runway-title{font-family:'Fredoka One',cursive;font-size:1.3rem;color:white;text-align:center;
  text-shadow:0 0 20px rgba(244,114,182,.5);}
.runway-name{font-family:'Fredoka One',cursive;font-size:1.8rem;
  background:linear-gradient(135deg,#fbbf24,#f472b6);-webkit-background-clip:text;
  -webkit-text-fill-color:transparent;background-clip:text;text-align:center;}

/* ‚îÄ‚îÄ JUDGE ‚îÄ‚îÄ */
#judgeScreen{justify-content:center;gap:1rem;
  background:linear-gradient(180deg,#1a0a2e 0%,#2d1b4e 100%);}
.judge-card{background:rgba(255,255,255,.08);backdrop-filter:blur(10px);
  border-radius:2rem;padding:1.5rem;width:100%;max-width:380px;
  border:2px solid rgba(255,255,255,.15);text-align:center;}
.judge-card h2{font-family:'Fredoka One',cursive;color:white;font-size:1.4rem;margin-bottom:.5rem;}
.judge-char-wrap{display:flex;justify-content:center;margin:.5rem 0;}
.judge-char-wrap svg{width:120px;height:200px;overflow:visible;}
.stars-row{display:flex;gap:.5rem;justify-content:center;margin:.8rem 0;}
.star{font-size:2.5rem;cursor:pointer;transition:all .2s;filter:grayscale(1);opacity:.5;}
.star.lit{filter:none;opacity:1;animation:starPop .3s cubic-bezier(.68,-.55,.27,1.55);}
@keyframes starPop{from{transform:scale(0)}to{transform:scale(1)}}
.star:hover{transform:scale(1.2);}
.judge-name{font-family:'Fredoka One',cursive;color:#fbbf24;font-size:1.2rem;margin:.3rem 0;}
.judge-tags{display:flex;flex-wrap:wrap;gap:.3rem;justify-content:center;margin-bottom:.5rem;}
.jtag{background:rgba(255,255,255,.1);border-radius:20px;padding:.15rem .55rem;
  font-size:.7rem;font-weight:700;color:rgba(255,255,255,.8);border:1px solid rgba(255,255,255,.2);}

/* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
#resultsScreen{justify-content:center;gap:1rem;
  background:linear-gradient(180deg,#1a0a2e 0%,#2d1b4e 100%);}
.result-card{background:rgba(255,255,255,.08);backdrop-filter:blur(10px);
  border-radius:2rem;padding:1.5rem 2rem;width:100%;max-width:380px;
  border:2px solid rgba(255,255,255,.15);text-align:center;}
.result-trophy{font-size:4rem;}
.result-title{font-family:'Fredoka One',cursive;font-size:2rem;
  background:linear-gradient(135deg,#fbbf24,#f472b6);-webkit-background-clip:text;
  -webkit-text-fill-color:transparent;background-clip:text;}
.result-scores{display:flex;gap:.8rem;justify-content:center;margin:1rem 0;}
.rscore{padding:.6rem 1rem;border-radius:14px;font-weight:800;text-align:center;}
.rscore.p1c{background:rgba(244,114,182,.2);border:2px solid var(--p1);color:#f9a8d4;}
.rscore.p2c{background:rgba(129,140,248,.2);border:2px solid var(--p2);color:#c7d2fe;}
.rscore .sv{font-family:'Fredoka One',cursive;font-size:1.6rem;color:white;}
.rscore .sn{font-size:.72rem;}
.result-stars{font-size:1.5rem;margin:.3rem 0;}

/* ‚îÄ‚îÄ PHASE SCREEN ‚îÄ‚îÄ */
.phase-screen{position:fixed;inset:0;background:linear-gradient(135deg,var(--p1),var(--p2));
  z-index:200;display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:.8rem;opacity:0;pointer-events:none;transition:opacity .3s;}
.phase-screen.show{opacity:1;pointer-events:all;}
.phase-big{font-family:'Fredoka One',cursive;font-size:clamp(2rem,8vw,4rem);
  color:white;text-align:center;padding:0 1rem;text-shadow:0 4px 20px rgba(0,0,0,.2);}
.phase-sub{color:rgba(255,255,255,.85);font-weight:700;font-size:.95rem;text-align:center;}

/* ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ */
.cf{position:fixed;pointer-events:none;z-index:300;border-radius:3px;
  animation:cfFall 1.8s ease-in forwards;}
@keyframes cfFall{from{transform:translateY(-30px) rotate(0);opacity:1}to{transform:translateY(105vh) rotate(600deg);opacity:0}}

@media(min-width:600px){
  .choices-grid{grid-template-columns:repeat(5,1fr);}
  .theme-grid{grid-template-columns:repeat(4,1fr);}
}
</style>
</head>
<body>

<div class="conn off" id="connBadge">‚ö™ Not Connected</div>

<!-- PHASE ANNOUNCE -->
<div class="phase-screen" id="phaseScreen">
  <div id="phaseEmoji" style="font-size:3rem">‚ú®</div>
  <div class="phase-big" id="phaseBig">Get Ready!</div>
  <div class="phase-sub" id="phaseSub"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen active" id="homeScreen">
  <div class="logo" style="margin-top:2rem">üëó Style Battle!</div>
  <p style="color:var(--soft);font-weight:700;font-size:.95rem;margin-bottom:1rem;text-align:center">The ultimate fashion showdown! üíÖ</p>
  <div class="home-btns">
    <button class="big-btn btn-primary" onclick="goCreate()"><span style="font-size:1.4rem">üéÆ</span> Create Room</button>
    <button class="big-btn btn-secondary" onclick="goJoin()"><span style="font-size:1.4rem">üîó</span> Join with Code</button>
    <button class="big-btn btn-green" onclick="goSolo()"><span style="font-size:1.4rem">üë§</span> Play Solo</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CREATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="createScreen">
  <div class="modal-card" style="margin-top:3rem">
    <h2>üéÆ Your Room</h2>
    <p style="color:var(--soft);font-weight:600;font-size:.88rem;text-align:center">Share this code with your friend!</p>
    <div class="room-code" id="roomCodeDisplay">----</div>
    <button class="btn btn-secondary" style="width:100%;padding:.5rem" onclick="copyCode()">üìã Copy Code</button>
    <input class="field" id="createName" placeholder="Your name" value="Shelly">
    <p style="color:var(--soft);font-weight:700;font-size:.85rem;text-align:center">
      Waiting for friend<span class="wait-dots"><span>.</span><span>.</span><span>.</span></span>
    </p>
    <p style="color:#15803d;font-size:.8rem;font-weight:700">üöÄ Game starts automatically when they join!</p>
    <button class="btn btn-secondary" style="width:100%;margin-top:.3rem" onclick="goHome()">‚Üê Back</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê JOIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="joinScreen">
  <div class="modal-card" style="margin-top:3rem">
    <h2 style="color:var(--p2)">üîó Join Room</h2>
    <p style="color:var(--soft);font-weight:600;font-size:.88rem;text-align:center">Ask your friend for their room code!</p>
    <input class="field code-field" id="joinCode" placeholder="CODE" maxlength="6" oninput="this.value=this.value.toUpperCase()">
    <input class="field" id="joinName" placeholder="Your name" value="Dad">
    <button class="big-btn btn-secondary" style="width:100%" onclick="doJoin()">üöÄ Join!</button>
    <div id="joinMsg" style="font-weight:700;font-size:.85rem;min-height:1.2rem;text-align:center"></div>
    <button class="btn btn-secondary" style="width:100%;background:white;color:var(--soft);border:2px solid #e9d5ff" onclick="goHome()">‚Üê Back</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê THEME SELECT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="themeScreen">
  <div class="logo" style="margin-top:.5rem;font-size:1.6rem">üé® Pick a Theme</div>
  <p style="color:var(--soft);font-weight:700;font-size:.85rem;margin-bottom:.3rem">Host picks the theme for this round!</p>
  <div class="theme-grid" id="themeGrid"></div>
  <button class="btn btn-primary" style="width:100%;max-width:500px;margin-top:.8rem;padding:.8rem" onclick="startWithTheme()">‚ñ∂ Start Dressing!</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DRESS-UP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="dressScreen">
  <div class="dress-top" style="max-width:500px;width:100%">
    <div class="theme-pill" id="dressThemeName">üëë Princess</div>
    <div class="timer-box" id="timerBox">3:00</div>
  </div>

  <!-- Character preview -->
  <div class="char-stage">
    <svg id="dressSvg" viewBox="0 0 180 310" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="dSkin" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#FDDBB4"/><stop offset="100%" stop-color="#F0B88A"/></linearGradient>
        <linearGradient id="dRainbow" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#f87171"/><stop offset="33%" stop-color="#facc15"/><stop offset="66%" stop-color="#4ade80"/><stop offset="100%" stop-color="#c084fc"/></linearGradient>
        <filter id="dDs"><feDropShadow dx="1" dy="3" stdDeviation="3" flood-opacity="0.12"/></filter>
      </defs>
      <ellipse cx="90" cy="306" rx="44" ry="6" fill="rgba(0,0,0,0.07)"/>
      <rect x="67" y="238" width="20" height="62" rx="10" fill="url(#dSkin)"/>
      <rect x="93" y="238" width="20" height="62" rx="10" fill="url(#dSkin)"/>
      <ellipse id="dSL" cx="77" cy="302" rx="17" ry="8" fill="#E8547A"/>
      <ellipse id="dSR" cx="103" cy="302" rx="17" ry="8" fill="#E8547A"/>
      <path id="dSkirt" d="M54 176 Q50 200 42 248 Q66 260 90 262 Q114 260 138 248 Q130 200 126 176 Z" fill="#FF85A1" filter="url(#dDs)"/>
      <rect id="dTorso" x="58" y="115" width="64" height="68" rx="14" fill="#FFB3C8" filter="url(#dDs)"/>
      <path id="dCollar" d="M80 115 Q90 128 100 115" fill="none" stroke="#FF85A1" stroke-width="4" stroke-linecap="round"/>
      <rect x="38" y="118" width="22" height="56" rx="11" fill="url(#dSkin)"/>
      <rect x="120" y="118" width="22" height="56" rx="11" fill="url(#dSkin)"/>
      <circle cx="49" cy="177" r="11" fill="url(#dSkin)"/>
      <circle cx="131" cy="177" r="11" fill="url(#dSkin)"/>
      <rect x="81" y="103" width="18" height="16" rx="6" fill="url(#dSkin)"/>
      <ellipse id="dHB" cx="90" cy="78" rx="44" ry="48" fill="#8B5A2B" filter="url(#dDs)"/>
      <ellipse cx="90" cy="80" rx="38" ry="42" fill="url(#dSkin)" filter="url(#dDs)"/>
      <ellipse cx="52" cy="82" rx="7" ry="9" fill="#F0B88A"/>
      <ellipse cx="128" cy="82" rx="7" ry="9" fill="#F0B88A"/>
      <ellipse id="dHF" cx="90" cy="56" rx="42" ry="24" fill="#8B5A2B"/>
      <path id="dHL" d="M52 64 Q72 46 90 44 Q108 46 128 64" fill="#8B5A2B"/>
      <path d="M68 64 Q76 59 82 62" stroke="#5C3317" stroke-width="2" fill="none" stroke-linecap="round"/>
      <path d="M98 62 Q104 59 112 64" stroke="#5C3317" stroke-width="2" fill="none" stroke-linecap="round"/>
      <ellipse cx="75" cy="78" rx="9" ry="10" fill="white"/>
      <ellipse cx="105" cy="78" rx="9" ry="10" fill="white"/>
      <ellipse cx="75" cy="79" rx="6" ry="7" fill="#5B3A8C"/>
      <ellipse cx="105" cy="79" rx="6" ry="7" fill="#5B3A8C"/>
      <ellipse cx="75" cy="80" rx="3.5" ry="4.5" fill="#1a0010"/>
      <ellipse cx="105" cy="80" rx="3.5" ry="4.5" fill="#1a0010"/>
      <ellipse cx="77" cy="76" rx="2" ry="2.5" fill="white" opacity=".9"/>
      <ellipse cx="107" cy="76" rx="2" ry="2.5" fill="white" opacity=".9"/>
      <path d="M66 71 Q71 67 75 70" stroke="#2C1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      <path d="M75 69 Q79 66 83 70" stroke="#2C1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      <path d="M97 70 Q101 66 105 69" stroke="#2C1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      <path d="M105 70 Q109 67 114 71" stroke="#2C1810" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      <path d="M86 91 Q90 96 94 91" stroke="#C8845A" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      <ellipse cx="62" cy="88" rx="12" ry="9" fill="rgba(255,133,161,0.25)"/>
      <ellipse cx="118" cy="88" rx="12" ry="9" fill="rgba(255,133,161,0.25)"/>
      <path d="M80 100 Q90 96 100 100 Q90 108 80 100" fill="rgba(232,84,122,0.3)" stroke="#E8547A" stroke-width="1.8" stroke-linecap="round"/>
      <g id="dHE"></g><g id="dAC"></g><g id="dHA"></g>
    </svg>
  </div>

  <!-- Category tabs -->
  <div class="cat-tabs" id="catTabs">
    <button class="cat-tab active" onclick="showCat('dress')">üëó Dress</button>
    <button class="cat-tab" onclick="showCat('hair')">üíá Hair</button>
    <button class="cat-tab" onclick="showCat('shoes')">üë† Shoes</button>
    <button class="cat-tab" onclick="showCat('acc')">‚ú® Extras</button>
  </div>

  <!-- Choices -->
  <div class="choices-grid" id="choicesGrid"></div>

  <!-- Custom type -->
  <div class="custom-row">
    <input class="custom-in" id="customIn" placeholder="Or type anything‚Ä¶ (e.g. red bow)">
    <button class="btn btn-primary" style="padding:.5rem .9rem" onclick="applyCustom()">‚ú®</button>
  </div>

  <div class="ready-btn-wrap">
    <button class="btn btn-gold ready-btn" onclick="goReady()">‚úÖ I'm Ready ‚Äî Show Runway!</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RUNWAY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="runwayScreen">
  <div style="text-align:center;padding-top:.5rem">
    <div class="runway-title">‚ú® Walk the Runway! ‚ú®</div>
    <div class="runway-name" id="runwayPlayerName">Shelly</div>
  </div>
  <div class="runway-wrap">
    <div class="runway-floor"></div>
    <div class="runway-lights">
      <div class="runway-light"></div><div class="runway-light"></div>
      <div class="runway-light"></div><div class="runway-light"></div>
      <div class="runway-light"></div>
    </div>
    <div class="runway-char" id="runwayChar">
      <svg id="runwaySvg" viewBox="0 0 180 310" xmlns="http://www.w3.org/2000/svg" style="width:110px;height:185px;overflow:visible">
        <!-- filled by JS -->
      </svg>
    </div>
  </div>
  <div id="runwayMsg" style="color:rgba(255,255,255,.7);font-weight:700;font-size:.9rem;text-align:center;padding:0 1rem"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê JUDGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="judgeScreen">
  <div class="judge-card">
    <h2>‚≠ê Rate the Look!</h2>
    <div class="judge-name" id="judgeName">Shelly's Outfit</div>
    <div class="judge-char-wrap">
      <svg id="judgeSvg" viewBox="0 0 180 310" xmlns="http://www.w3.org/2000/svg" style="overflow:visible">
        <!-- filled by JS -->
      </svg>
    </div>
    <div class="judge-tags" id="judgeTags"></div>
    <p style="color:rgba(255,255,255,.7);font-weight:700;font-size:.85rem;margin-bottom:.3rem">How many stars? üåü</p>
    <div class="stars-row" id="starsRow">
      <span class="star" onclick="rateStar(1)">‚≠ê</span>
      <span class="star" onclick="rateStar(2)">‚≠ê</span>
      <span class="star" onclick="rateStar(3)">‚≠ê</span>
      <span class="star" onclick="rateStar(4)">‚≠ê</span>
      <span class="star" onclick="rateStar(5)">‚≠ê</span>
    </div>
    <div id="starMsg" style="color:#fbbf24;font-family:'Fredoka One',cursive;font-size:1rem;min-height:1.4rem;text-align:center"></div>
    <button class="btn btn-gold" style="width:100%;margin-top:.6rem;padding:.7rem" id="submitStarsBtn" onclick="submitStars()" disabled>Submit Rating!</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESULTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="resultsScreen">
  <div class="result-card">
    <div class="result-trophy" id="resTrophy">üèÜ</div>
    <div class="result-title" id="resTitle">Winner!</div>
    <div style="color:white;font-weight:800;font-size:1rem;margin:.3rem 0" id="resWinner"></div>
    <div class="result-scores">
      <div class="rscore p1c">
        <div class="sn" id="resN1">P1</div>
        <div class="sv" id="resStars1">0</div>
        <div style="font-size:.8rem;color:#f9a8d4">‚≠ê stars</div>
      </div>
      <div class="rscore p2c">
        <div class="sn" id="resN2">P2</div>
        <div class="sv" id="resStars2">0</div>
        <div style="font-size:.8rem;color:#c7d2fe">‚≠ê stars</div>
      </div>
    </div>
    <div id="resReason" style="color:rgba(255,255,255,.7);font-size:.82rem;font-weight:600;line-height:1.5;margin-bottom:1rem"></div>
    <button class="btn btn-primary" style="width:100%;padding:.8rem" onclick="playAgain()">üîÑ Play Again!</button>
    <button class="btn" style="width:100%;margin-top:.5rem;padding:.7rem;background:rgba(255,255,255,.1);color:white;border:2px solid rgba(255,255,255,.2)" onclick="goHome()">üè† Home</button>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DATA ‚Äî 15 choices per category
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DRESSES = [
  {id:'princess-pink', name:'Princess Gown', emoji:'üëó', color:'#FF85A1', skirtPath:'M46 176 Q40 198 30 250 Q62 268 90 270 Q118 268 150 250 Q140 198 134 176 Z', topColor:'#FF85A1'},
  {id:'elsa', name:'Elsa Dress', emoji:'üßä', color:'#7dd3fc', skirtPath:'M46 176 Q40 198 30 250 Q62 268 90 270 Q118 268 150 250 Q140 198 134 176 Z', topColor:'#7dd3fc'},
  {id:'witch-dress', name:'Witch Robe', emoji:'üîÆ', color:'#7c3aed', skirtPath:'M54 176 Q50 200 42 248 Q66 260 90 262 Q114 260 138 248 Q130 200 126 176 Z', topColor:'#1c1c1c'},
  {id:'flower-dress', name:'Flower Dress', emoji:'üå∏', color:'#fb7185', skirtPath:'M54 176 Q50 200 42 248 Q66 260 90 262 Q114 260 138 248 Q130 200 126 176 Z', topColor:'#fda4af', flowers:true},
  {id:'mulan', name:'Mulan Kimono', emoji:'üá®üá≥', color:'#dc2626', skirtPath:'M54 176 Q50 200 42 248 Q66 260 90 262 Q114 260 138 248 Q130 200 126 176 Z', topColor:'#dc2626'},
  {id:'mermaid-dress', name:'Mermaid Gown', emoji:'üßú', color:'#14b8a6', skirtPath:'M60 176 Q58 205 50 252 Q70 264 90 266 Q110 264 130 252 Q122 205 120 176 Z', topColor:'#0891b2'},
  {id:'hogwarts', name:'Hogwarts Robe', emoji:'‚ö°', color:'#1e3a5f', skirtPath:'M48 176 Q44 200 36 250 Q64 264 90 266 Q116 264 144 250 Q136 200 132 176 Z', topColor:'#1e3a5f'},
  {id:'wicked', name:'Wicked Dress', emoji:'üü¢', color:'#16a34a', skirtPath:'M46 176 Q40 198 30 250 Q62 268 90 270 Q118 268 150 250 Q140 198 134 176 Z', topColor:'#15803d'},
  {id:'tutu', name:'Ballet Tutu', emoji:'ü©∞', color:'#fce7f3', skirtPath:'M44 176 Q38 194 26 244 Q60 268 90 272 Q120 268 154 244 Q142 194 136 176 Z', topColor:'#fbcfe8'},
  {id:'rainbow-dress', name:'Rainbow Dress', emoji:'üåà', color:'rainbow', skirtPath:'M46 176 Q40 198 30 250 Q62 268 90 270 Q118 268 150 250 Q140 198 134 176 Z', topColor:'rainbow'},
  {id:'gold-dress', name:'Gold Gown', emoji:'‚ú®', color:'#fbbf24', skirtPath:'M46 176 Q40 198 30 250 Q62 268 90 270 Q118 268 150 250 Q140 198 134 176 Z', topColor:'#fbbf24'},
  {id:'night-dress', name:'Night Queen', emoji:'üåô', color:'#312e81', skirtPath:'M46 176 Q40 198 30 250 Q62 268 90 270 Q118 268 150 250 Q140 198 134 176 Z', topColor:'#1e1b4b'},
  {id:'cherry-dress', name:'Cherry Blossom', emoji:'üå∫', color:'#f43f5e', skirtPath:'M54 176 Q50 200 42 248 Q66 260 90 262 Q114 260 138 248 Q130 200 126 176 Z', topColor:'#fb7185', flowers:true},
  {id:'ocean-dress', name:'Ocean Blue', emoji:'üåä', color:'#3b82f6', skirtPath:'M46 176 Q40 198 30 250 Q62 268 90 270 Q118 268 150 250 Q140 198 134 176 Z', topColor:'#60a5fa'},
  {id:'candy-dress', name:'Candy Stripe', emoji:'üç¨', color:'#e879f9', skirtPath:'M54 176 Q50 200 42 248 Q66 260 90 262 Q114 260 138 248 Q130 200 126 176 Z', topColor:'#f0abfc'},
];

const HAIRSTYLES = [
  {id:'default', name:'Flowing', emoji:'üíÜ', style:'default', color:'#8B5A2B'},
  {id:'blonde-long', name:'Blonde Long', emoji:'üë±', style:'long', color:'#F5DEB3'},
  {id:'black-bun', name:'Black Bun', emoji:'üñ§', style:'bun', color:'#1c1c1c'},
  {id:'2-braids', name:'2 Braids', emoji:'ü™¢', style:'braids', color:'#8B5A2B'},
  {id:'blonde-braids', name:'Blonde Braids', emoji:'üåæ', style:'braids', color:'#F5DEB3'},
  {id:'red-curly', name:'Red Curls', emoji:'üî¥', style:'curly', color:'#dc2626'},
  {id:'black-ponytail', name:'Black Ponytail', emoji:'üñ§', style:'ponytail', color:'#1c1c1c'},
  {id:'pink-pigtails', name:'Pink Pigtails', emoji:'üéÄ', style:'pigtails', color:'#FF85A1'},
  {id:'silver-waves', name:'Silver Waves', emoji:'üåä', style:'waves', color:'#d1d5db'},
  {id:'braid-crown', name:'Braid Crown', emoji:'üëë', style:'braidcrown', color:'#F5DEB3'},
  {id:'elsa-braid', name:'Elsa Braid', emoji:'‚ùÑÔ∏è', style:'ponytail', color:'#bae6fd'},
  {id:'rainbow-curly', name:'Rainbow Curls', emoji:'üåà', style:'curly', color:'rainbow'},
  {id:'purple-bun', name:'Purple Bun', emoji:'üíú', style:'bun', color:'#9333ea'},
  {id:'short-dark', name:'Short Dark', emoji:'üíá', style:'short', color:'#2d1b4e'},
  {id:'pixie-gold', name:'Pixie Gold', emoji:'‚ú®', style:'pixie', color:'#fbbf24'},
];

const SHOES = [
  {id:'pink-heels', name:'Pink Heels', emoji:'üë†', color:'#FF85A1', style:'heels'},
  {id:'glass-slipper', name:'Glass Slipper', emoji:'ü´ß', color:'rgba(180,220,255,0.85)', style:'glass'},
  {id:'golden-heels', name:'Gold Heels', emoji:'‚ú®', color:'#fbbf24', style:'heels'},
  {id:'red-boots', name:'Red Boots', emoji:'ü•æ', color:'#dc2626', style:'boots'},
  {id:'black-boots', name:'Black Boots', emoji:'üñ§', color:'#1c1c1c', style:'boots'},
  {id:'white-sneakers', name:'White Sneakers', emoji:'üëü', color:'#FFFFFF', style:'sneakers'},
  {id:'pink-sneakers', name:'Pink Sneakers', emoji:'ü©∑', color:'#fce7f3', style:'sneakers'},
  {id:'silver-heels', name:'Silver Heels', emoji:'ü™©', color:'#d1d5db', style:'heels'},
  {id:'purple-boots', name:'Purple Boots', emoji:'üíú', color:'#9333ea', style:'boots'},
  {id:'gold-sandals', name:'Gold Sandals', emoji:'üåü', color:'#fbbf24', style:'sandals'},
  {id:'blue-flats', name:'Blue Flats', emoji:'üíô', color:'#3b82f6', style:'flats'},
  {id:'red-heels', name:'Red Heels', emoji:'‚ù§Ô∏è', color:'#dc2626', style:'heels'},
  {id:'rainbow-shoes', name:'Rainbow', emoji:'üåà', color:'rainbow', style:'sneakers'},
  {id:'teal-sandals', name:'Teal Sandals', emoji:'ü©µ', color:'#14b8a6', style:'sandals'},
  {id:'white-boots', name:'White Boots', emoji:'ü§ç', color:'#f5f5f5', style:'boots'},
];

const ACCESSORIES = [
  {id:'crown', name:'Crown', emoji:'üëë'},
  {id:'tiara', name:'Tiara', emoji:'üíé'},
  {id:'flower', name:'Flower', emoji:'üå∏'},
  {id:'bow', name:'Hair Bow', emoji:'üéÄ'},
  {id:'stars', name:'Star Clips', emoji:'‚≠ê'},
  {id:'necklace', name:'Necklace', emoji:'üìø'},
  {id:'earrings', name:'Earrings', emoji:'üí´'},
  {id:'glasses', name:'Glasses', emoji:'üëì'},
  {id:'wings', name:'Fairy Wings', emoji:'ü¶ã'},
  {id:'wand', name:'Magic Wand', emoji:'ü™Ñ'},
  {id:'witchhat', name:'Witch Hat', emoji:'üé©'},
  {id:'scarf', name:'Scarf', emoji:'üß£'},
  {id:'cape', name:'Cape', emoji:'ü¶∏'},
  {id:'hearts', name:'Hearts', emoji:'üíñ'},
  {id:'hat', name:'Fancy Hat', emoji:'üé©'},
];

const THEMES = [
  {id:'princess', name:'üëë Princess', emoji:'üëë', kw:'royal ¬∑ pink ¬∑ elegant ¬∑ crown ¬∑ sparkle'},
  {id:'frozen', name:'‚ùÑÔ∏è Frozen', emoji:'‚ùÑÔ∏è', kw:'ice ¬∑ blue ¬∑ silver ¬∑ snow ¬∑ Elsa'},
  {id:'potter', name:'‚ö° Harry Potter', emoji:'‚ö°', kw:'magic ¬∑ robes ¬∑ wand ¬∑ Hogwarts ¬∑ mysterious'},
  {id:'mulan', name:'üå∏ Mulan', emoji:'üå∏', kw:'silk ¬∑ red ¬∑ gold ¬∑ brave ¬∑ warrior'},
  {id:'mermaid', name:'üßú Mermaid', emoji:'üßú', kw:'ocean ¬∑ teal ¬∑ blue ¬∑ waves ¬∑ shells'},
  {id:'wicked', name:'üü¢ Wicked', emoji:'üü¢', kw:'green ¬∑ black ¬∑ magic ¬∑ dark ¬∑ witchy'},
  {id:'halloween', name:'üéÉ Halloween', emoji:'üéÉ', kw:'spooky ¬∑ black ¬∑ orange ¬∑ witch ¬∑ dark'},
  {id:'nightqueen', name:'üåô Night Queen', emoji:'üåô', kw:'dark ¬∑ silver ¬∑ stars ¬∑ midnight ¬∑ elegant'},
  {id:'garden', name:'üå∫ Garden Party', emoji:'üå∫', kw:'flowers ¬∑ pastel ¬∑ soft ¬∑ spring ¬∑ floral'},
  {id:'candy', name:'üç¨ Candy Land', emoji:'üç¨', kw:'pink ¬∑ sweet ¬∑ rainbow ¬∑ fun ¬∑ bright'},
  {id:'school', name:'üè´ School Glam', emoji:'üè´', kw:'cute ¬∑ trendy ¬∑ fun ¬∑ colourful ¬∑ chic'},
  {id:'beach', name:'üåä Beach Goddess', emoji:'üåä', kw:'summer ¬∑ bright ¬∑ tropical ¬∑ waves ¬∑ sun'},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let myRole = null;
let roomCode = '';
let myName = 'Shelly';
let themName = 'Player 2';
let currentTheme = THEMES[0];
let selectedThemeIdx = 0;
let currentCat = 'dress';
let myOutfit = {dress:null, hair:HAIRSTYLES[0], shoes:null, accs:[], items:[]};
let themOutfit = {dress:null, hair:HAIRSTYLES[0], shoes:null, accs:[], items:[]};
let myStars = 0;
let themStars = 0;
let timerInterval = null;
let timeLeft = 180;
let peer = null;
let conn = null;
let currentJudgeFor = null; // 'them' or 'me'
let judgeRound = 0; // 0 = judge p1, 1 = judge p2

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NETWORKING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setConn(ok, msg){
  const el = document.getElementById('connBadge');
  el.textContent = msg;
  el.className = 'conn ' + (ok ? 'on' : (msg.includes('Wait') ? 'wait' : 'off'));
}

function send(type, data={}){
  if(conn && conn.open) conn.send({type, from:myRole, ...data});
}

function setupConn(c){
  conn = c;
  conn.on('open', ()=> setConn(true, 'üü¢ Connected!'));
  conn.on('data', d=> handleMsg(d));
  conn.on('close', ()=> setConn(false, 'üî¥ Disconnected'));
  conn.on('error', ()=> setConn(false, 'üî¥ Error'));
}

function initHost(code){
  if(peer) peer.destroy();
  peer = new Peer('stylebattle-' + code);
  peer.on('open', ()=> setConn(false, '‚è≥ Waiting‚Ä¶'));
  peer.on('connection', c=>{
    setupConn(c);
    // Auto-start: go to theme selection
    myName = document.getElementById('createName').value || 'Shelly';
    send('connected', {name: myName});
    showScreen('themeScreen');
    buildThemeGrid();
  });
  peer.on('error', e=>{
    if(e.type==='unavailable-id'){
      const id2 = 'stylebattle-'+code+'-'+Math.random().toString(36).substring(2,4);
      roomCode = id2.replace('stylebattle-','');
      document.getElementById('roomCodeDisplay').textContent = roomCode;
      peer = new Peer(id2);
      peer.on('open', ()=> setConn(false,'‚è≥ Waiting‚Ä¶'));
      peer.on('connection', c=>{ setupConn(c); myName=document.getElementById('createName').value||'Shelly'; send('connected',{name:myName}); showScreen('themeScreen'); buildThemeGrid(); });
    }
  });
}

function initGuest(code){
  if(peer) peer.destroy();
  peer = new Peer();
  peer.on('open', ()=>{
    setConn(false, 'üîó Connecting‚Ä¶');
    const c = peer.connect('stylebattle-'+code, {reliable:true});
    setupConn(c);
    let tries = 0;
    const poll = setInterval(()=>{
      tries++;
      if(conn && conn.open){
        clearInterval(poll);
        myName = document.getElementById('joinName').value || 'Dad';
        send('join', {name: myName});
        document.getElementById('joinMsg').textContent = '‚úÖ Connected! Starting‚Ä¶';
        document.getElementById('joinMsg').style.color = '#15803d';
      } else if(tries > 15){
        clearInterval(poll);
        document.getElementById('joinMsg').textContent = '‚ùå Could not connect. Check the code!';
        document.getElementById('joinMsg').style.color = '#b91c1c';
      }
    }, 600);
  });
  peer.on('error', ()=>{
    document.getElementById('joinMsg').textContent = '‚ùå Could not connect. Check the code!';
    document.getElementById('joinMsg').style.color = '#b91c1c';
  });
}

function handleMsg(msg){
  if(msg.type === 'connected'){
    themName = msg.name;
  }
  if(msg.type === 'join'){
    themName = msg.name;
  }
  if(msg.type === 'themeSelected'){
    currentTheme = THEMES[msg.idx];
    selectedThemeIdx = msg.idx;
    showScreen('dressScreen');
    buildChoices(currentCat);
    applyThemeUI();
    startTimer();
    showPhase(currentTheme.emoji, currentTheme.name, currentTheme.kw);
  }
  if(msg.type === 'ready'){
    // Other player is ready - if we're also ready, start runway
    if(myRole === 'host'){
      themOutfit = msg.outfit;
      // Start judging sequence
      send('startRunway', {who:'p1', name:myName, outfit:myOutfit});
      startRunway('p1', myName, myOutfit);
    }
  }
  if(msg.type === 'startRunway'){
    startRunway(msg.who, msg.name, msg.outfit);
  }
  if(msg.type === 'startJudge'){
    // Guest judges host's outfit
    currentJudgeFor = msg.who;
    showJudgeScreen(msg.name, msg.outfit);
  }
  if(msg.type === 'stars'){
    // Received star rating
    if(msg.for === 'p1'){
      // p2 rated p1
      themStars = msg.stars;
      // now show p2's runway
      send('startRunway', {who:'p2', name:themName, outfit:themOutfit});
      startRunway('p2', themName, themOutfit);
    } else if(msg.for === 'p2'){
      myStars = msg.stars;
      // show results
      showResults();
      send('showResults', {myStars, themStars});
    }
  }
  if(msg.type === 'showResults'){
    myStars = msg.themStars !== undefined ? msg.themStars : myStars;
    themStars = msg.myStars !== undefined ? msg.myStars : themStars;
    showResults();
  }
  if(msg.type === 'playAgain'){
    resetGame();
    if(myRole === 'host'){
      showScreen('themeScreen');
      buildThemeGrid();
    } else {
      showScreen('dressScreen');
    }
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SCREENS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function goHome(){ stopTimer(); showScreen('homeScreen'); }
function goCreate(){
  roomCode = Math.random().toString(36).substring(2,6).toUpperCase();
  document.getElementById('roomCodeDisplay').textContent = roomCode;
  myRole = 'host';
  initHost(roomCode);
  showScreen('createScreen');
}
function goJoin(){ myRole = 'guest'; showScreen('joinScreen'); }
function doJoin(){
  const code = document.getElementById('joinCode').value.trim().toUpperCase();
  if(code.length < 3){ document.getElementById('joinMsg').textContent='Enter a code!'; return; }
  roomCode = code;
  initGuest(roomCode);
}
function copyCode(){
  navigator.clipboard.writeText(roomCode).catch(()=>{});
  const btn = event.target;
  btn.textContent = '‚úÖ Copied!';
  setTimeout(()=> btn.textContent='üìã Copy Code', 2000);
}
function goSolo(){
  myRole = 'solo';
  myName = 'Shelly';
  themName = 'Player 2';
  setConn(true, 'üü¢ Solo Mode');
  showScreen('themeScreen');
  buildThemeGrid();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  THEME SELECTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildThemeGrid(){
  const grid = document.getElementById('themeGrid');
  grid.innerHTML = '';
  THEMES.forEach((t,i)=>{
    const div = document.createElement('div');
    div.className = 'theme-card' + (i===selectedThemeIdx?' selected':'');
    div.innerHTML = `<div class="t-emoji">${t.emoji}</div><div class="t-name">${t.name}</div><div class="t-kw">${t.kw}</div>`;
    div.onclick = ()=>{
      document.querySelectorAll('.theme-card').forEach(c=>c.classList.remove('selected'));
      div.classList.add('selected');
      selectedThemeIdx = i;
    };
    grid.appendChild(div);
  });
}

function startWithTheme(){
  currentTheme = THEMES[selectedThemeIdx];
  send('themeSelected', {idx: selectedThemeIdx});
  showScreen('dressScreen');
  buildChoices(currentCat);
  applyThemeUI();
  startTimer();
  showPhase(currentTheme.emoji, currentTheme.name, currentTheme.kw);
}

function applyThemeUI(){
  document.getElementById('dressThemeName').textContent = currentTheme.name;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CHOICES GRID
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showCat(cat){
  currentCat = cat;
  document.querySelectorAll('.cat-tab').forEach(t=>{
    t.classList.toggle('active', t.textContent.toLowerCase().includes(
      cat==='dress'?'dress':cat==='hair'?'hair':cat==='shoes'?'shoe':'extra'
    ));
  });
  buildChoices(cat);
}

function buildChoices(cat){
  const grid = document.getElementById('choicesGrid');
  grid.innerHTML = '';
  let items = cat==='dress' ? DRESSES : cat==='hair' ? HAIRSTYLES : cat==='shoes' ? SHOES : ACCESSORIES;
  items.forEach(item=>{
    const div = document.createElement('div');
    div.className = 'choice-card';
    // Check if selected
    let sel = false;
    if(cat==='dress') sel = myOutfit.dress?.id === item.id;
    if(cat==='hair') sel = myOutfit.hair?.id === item.id;
    if(cat==='shoes') sel = myOutfit.shoes?.id === item.id;
    if(cat==='acc') sel = myOutfit.accs.some(a=>a.id===item.id);
    if(sel) div.classList.add('selected');

    let colorDot = item.color && item.color !== 'rainbow' ? `<div class="c-color" style="background:${item.color}"></div>` : item.color==='rainbow'?'<div class="c-color" style="background:linear-gradient(135deg,#f87171,#facc15,#4ade80,#c084fc)"></div>':'';
    div.innerHTML = `<div class="c-emoji">${item.emoji}</div><div class="c-name">${item.name}</div>${colorDot}`;
    div.onclick = ()=> selectItem(cat, item, div);
    grid.appendChild(div);
  });
}

function selectItem(cat, item, div){
  if(cat==='dress'){
    myOutfit.dress = item;
    applyDress(item, 'd');
  } else if(cat==='hair'){
    myOutfit.hair = item;
    applyHair(item, 'd');
  } else if(cat==='shoes'){
    myOutfit.shoes = item;
    applyShoes(item, 'd');
  } else if(cat==='acc'){
    if(myOutfit.accs.some(a=>a.id===item.id)){
      myOutfit.accs = myOutfit.accs.filter(a=>a.id!==item.id);
      div.classList.remove('selected');
      // Rebuild accessories
      document.getElementById('dHA').innerHTML='';
      document.getElementById('dAC').innerHTML='';
      myOutfit.accs.forEach(a=> applyAcc(a,'d'));
      return;
    }
    myOutfit.accs.push(item);
    applyAcc(item,'d');
  }
  // Update selection UI
  document.querySelectorAll('.choice-card').forEach(c=>{
    if(cat!=='acc') c.classList.remove('selected');
  });
  div.classList.add('selected');
}

function applyCustom(){
  const val = document.getElementById('customIn').value.trim();
  if(!val) return;
  // Try to match to existing items
  const lower = val.toLowerCase();
  let found = false;
  [...DRESSES,...HAIRSTYLES,...SHOES,...ACCESSORIES].forEach(item=>{
    if(item.name.toLowerCase().includes(lower) || lower.includes(item.id)){
      const cat = DRESSES.includes(item)?'dress':HAIRSTYLES.includes(item)?'hair':SHOES.includes(item)?'shoes':'acc';
      selectItem(cat, item, document.createElement('div'));
      found = true;
    }
  });
  if(!found) myOutfit.items.push(val);
  document.getElementById('customIn').value = '';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CHARACTER RENDERING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function svgEl(tag, attrs){
  const el = document.createElementNS('http://www.w3.org/2000/svg', tag);
  for(const [k,v] of Object.entries(attrs)) el.setAttribute(k,v);
  return el;
}
function fillOf(color, prefix){
  if(color==='rainbow') return `url(#${prefix}Rainbow)`;
  return color;
}
function shade(hex,n){
  if(!hex||hex==='rainbow'||hex.startsWith('rgba')||hex.startsWith('url'))return hex;
  let r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
  r=Math.max(0,Math.min(255,r+n));g=Math.max(0,Math.min(255,g+n));b=Math.max(0,Math.min(255,b+n));
  return'#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
}

function applyDress(item, prefix){
  const f = fillOf(item.color, prefix);
  const ft = fillOf(item.topColor, prefix);
  document.getElementById(prefix+'Skirt').setAttribute('fill', f);
  document.getElementById(prefix+'Skirt').setAttribute('d', item.skirtPath);
  document.getElementById(prefix+'Torso').setAttribute('fill', ft);
  document.getElementById(prefix+'Collar').setAttribute('stroke', shade(item.topColor, -20));
  // Flowers on dress
  if(item.flowers){
    const ac = document.getElementById(prefix+'AC');
    // remove old flowers
    ac.querySelectorAll('.dress-flower').forEach(e=>e.remove());
    [[68,220],[100,240],[130,215],[85,250]].forEach(([cx,cy])=>{
      const g2 = svgEl('g',{class:'dress-flower'});
      ['#FF85A1','#FFB3C8','#FF6B9D'].forEach((c,i)=>{
        const a=i*120*Math.PI/180;
        const p = svgEl('ellipse',{cx:cx+Math.cos(a)*6,cy:cy+Math.sin(a)*6,rx:'5',ry:'3',fill:c,transform:`rotate(${i*120},${cx},${cy})`});
        g2.appendChild(p);
      });
      g2.appendChild(svgEl('circle',{cx,cy,r:'4',fill:'#FFD700'}));
      ac.appendChild(g2);
    });
  }
}

function applyHair(item, prefix){
  const f = fillOf(item.color, prefix);
  const hb=document.getElementById(prefix+'HB');
  const hf=document.getElementById(prefix+'HF');
  const hl=document.getElementById(prefix+'HL');
  const he=document.getElementById(prefix+'HE');
  hb.setAttribute('fill',f); hf.setAttribute('fill',f); hl.setAttribute('fill',f);
  he.innerHTML='';
  const add=(tag,attrs)=>{const el=svgEl(tag,attrs);he.appendChild(el);return el;};
  const sh=shade(item.color,-30);
  const style=item.style;

  if(style==='long'){hb.setAttribute('rx','44');hb.setAttribute('ry','72');hb.setAttribute('cy','84');hf.setAttribute('cx','90');hf.setAttribute('cy','54');hf.setAttribute('rx','42');hf.setAttribute('ry','22');hl.setAttribute('d','M52 62 Q72 44 90 42 Q108 44 128 62');}
  else if(style==='short'){hb.setAttribute('rx','44');hb.setAttribute('ry','40');hb.setAttribute('cy','76');hf.setAttribute('cx','90');hf.setAttribute('cy','54');hf.setAttribute('rx','40');hf.setAttribute('ry','18');hl.setAttribute('d','M54 62 Q72 46 90 44 Q108 46 126 62');}
  else if(style==='braids'){hb.setAttribute('rx','44');hb.setAttribute('ry','48');hb.setAttribute('cy','78');hf.setAttribute('cx','90');hf.setAttribute('cy','56');hf.setAttribute('rx','42');hf.setAttribute('ry','24');hl.setAttribute('d','M52 64 Q72 46 90 44 Q108 46 128 64');[[68,110],[112,110]].forEach(([bx,by])=>{for(let i=0;i<7;i++)add('ellipse',{cx:bx,cy:by+i*14,rx:'8',ry:'7',fill:f,stroke:sh,'stroke-width':'1.5'});});}
  else if(style==='braidcrown'){hb.setAttribute('rx','44');hb.setAttribute('ry','48');hb.setAttribute('cy','78');hf.setAttribute('cx','90');hf.setAttribute('cy','56');hf.setAttribute('rx','42');hf.setAttribute('ry','24');hl.setAttribute('d','M52 64 Q72 46 90 44 Q108 46 128 64');add('path',{d:'M52 64 Q72 38 90 34 Q108 38 128 64',fill:'none',stroke:f,'stroke-width':'14','stroke-linecap':'round'});add('path',{d:'M52 64 Q72 38 90 34 Q108 38 128 64',fill:'none',stroke:sh,'stroke-width':'3','stroke-linecap':'round','stroke-dasharray':'5,7'});}
  else if(style==='ponytail'){hb.setAttribute('rx','44');hb.setAttribute('ry','48');hb.setAttribute('cy','78');hf.setAttribute('cx','90');hf.setAttribute('cy','56');hf.setAttribute('rx','42');hf.setAttribute('ry','22');hl.setAttribute('d','M52 62 Q72 44 90 42 Q108 44 128 62');add('path',{d:'M118 60 Q145 76 140 126 Q135 158 126 172 Q116 162 120 130 Q128 98 108 68 Z',fill:f});add('ellipse',{cx:'124',cy:'62',rx:'7',ry:'7',fill:sh});}
  else if(style==='pigtails'){hb.setAttribute('rx','44');hb.setAttribute('ry','48');hb.setAttribute('cy','78');hf.setAttribute('cx','90');hf.setAttribute('cy','56');hf.setAttribute('rx','42');hf.setAttribute('ry','22');hl.setAttribute('d','M52 62 Q72 44 90 42 Q108 44 128 62');add('path',{d:'M52 74 Q28 90 26 136 Q24 166 33 180 Q45 170 42 140 Q46 108 60 84 Z',fill:f});add('path',{d:'M128 74 Q152 90 154 136 Q156 166 147 180 Q135 170 138 140 Q134 108 120 84 Z',fill:f});}
  else if(style==='curly'){hb.setAttribute('rx','50');hb.setAttribute('ry','56');hb.setAttribute('cy','80');hf.setAttribute('cx','90');hf.setAttribute('cy','56');hf.setAttribute('rx','48');hf.setAttribute('ry','26');hl.setAttribute('d','M48 66 Q70 46 90 44 Q110 46 132 66');[[52,92],[64,112],[78,122],[92,126],[106,122],[120,112],[128,92]].forEach(([cx,cy])=>add('circle',{cx,cy,r:'12',fill:f}));}
  else if(style==='bun'){hb.setAttribute('rx','44');hb.setAttribute('ry','46');hb.setAttribute('cy','80');hf.setAttribute('cx','90');hf.setAttribute('cy','58');hf.setAttribute('rx','42');hf.setAttribute('ry','20');hl.setAttribute('d','M52 64 Q72 48 90 46 Q108 48 128 64');add('circle',{cx:'90',cy:'42',r:'20',fill:f,stroke:sh,'stroke-width':'2.5'});add('path',{d:'M82 40 Q90 33 98 40 Q96 46 90 48 Q84 46 82 40',fill:'none',stroke:sh,'stroke-width':'1.5'});}
  else if(style==='waves'){hb.setAttribute('rx','44');hb.setAttribute('ry','68');hb.setAttribute('cy','82');hf.setAttribute('cx','90');hf.setAttribute('cy','56');hf.setAttribute('rx','42');hf.setAttribute('ry','24');hl.setAttribute('d','M52 64 Q72 46 90 44 Q108 46 128 64');[[48,88],[132,88]].forEach(([sx,sy],i)=>{const ox=i===0?12:-12;add('path',{d:`M${sx} ${sy} Q${sx+ox} ${sy+16} ${sx} ${sy+32} Q${sx-ox} ${sy+48} ${sx} ${sy+64} Q${sx+ox} ${sy+80} ${sx} ${sy+96}`,stroke:f,'stroke-width':'16',fill:'none','stroke-linecap':'round'});});}
  else if(style==='pixie'){hb.setAttribute('rx','44');hb.setAttribute('ry','36');hb.setAttribute('cy','76');hf.setAttribute('cx','90');hf.setAttribute('cy','54');hf.setAttribute('rx','42');hf.setAttribute('ry','18');hl.setAttribute('d','M54 60 Q72 46 90 44 Q108 46 126 60');}
  else{hb.setAttribute('rx','44');hb.setAttribute('ry','48');hb.setAttribute('cy','78');hf.setAttribute('cx','90');hf.setAttribute('cy','56');hf.setAttribute('rx','42');hf.setAttribute('ry','24');hl.setAttribute('d','M52 64 Q72 46 90 44 Q108 46 128 64');}
}

function applyShoes(item, prefix){
  const sl=document.getElementById(prefix+'SL'), sr=document.getElementById(prefix+'SR');
  sl.setAttribute('fill', item.color); sr.setAttribute('fill', item.color);
  if(item.style==='boots'){sl.setAttribute('ry','11');sl.setAttribute('cy','298');sr.setAttribute('ry','11');sr.setAttribute('cy','298');}
  else if(item.style==='heels'){sl.setAttribute('ry','7');sl.setAttribute('cy','302');sr.setAttribute('ry','7');sr.setAttribute('cy','302');}
  else{sl.setAttribute('ry','8');sl.setAttribute('cy','302');sr.setAttribute('ry','8');sr.setAttribute('cy','302');}
}

function applyAcc(item, prefix){
  const ha=document.getElementById(prefix+'HA');
  const ac=document.getElementById(prefix+'AC');
  const add=(parent,tag,attrs)=>{const el=svgEl(tag,attrs);parent.appendChild(el);return el;};
  const type=item.id;
  if(type==='crown'){add(ha,'path',{d:'M58 42 L65 24 L75 38 L90 18 L105 38 L115 24 L122 42 Z',fill:'#FFD700',stroke:'#F59E0B','stroke-width':'2'});['#FF85A1','#9333ea','#3b82f6'].forEach((c,i)=>add(ha,'circle',{cx:68+i*16,cy:34,r:'3.5',fill:c}));}
  else if(type==='tiara'){add(ha,'path',{d:'M54 52 Q64 36 78 44 Q90 30 102 44 Q116 36 126 52',stroke:'#FFD700','stroke-width':'4',fill:'none','stroke-linecap':'round'});add(ha,'circle',{cx:'90',cy:'32',r:'5',fill:'#FF85A1'});}
  else if(type==='flower'){const cx=124,cy=48;['#FF85A1','#FFB3C8','#FF6B9D','#FFD6E0','#FF85A1'].forEach((c,i)=>{const a=i*72*Math.PI/180;add(ha,'ellipse',{cx:cx+Math.cos(a)*8,cy:cy+Math.sin(a)*8,rx:'6',ry:'4',fill:c,transform:`rotate(${i*72},${cx},${cy})`});});add(ha,'circle',{cx,cy,r:'5',fill:'#FFD700'});}
  else if(type==='bow'){add(ha,'path',{d:'M70 38 Q56 28 58 40 Q60 52 70 46 Q80 52 82 40 Q84 28 70 38 Z',fill:'#FF85A1',stroke:'#E8547A','stroke-width':'1.5'});add(ha,'circle',{cx:'70',cy:'42',r:'4',fill:'#E8547A'});}
  else if(type==='stars'){[[60,38],[122,42]].forEach(([cx,cy])=>{const pts=[];for(let i=0;i<10;i++){const a=(i*36-90)*Math.PI/180,r=i%2===0?9:4.5;pts.push(`${cx+r*Math.cos(a)},${cy+r*Math.sin(a)}`);}add(ha,'polygon',{points:pts.join(' '),fill:'#FFD700'});});}
  else if(type==='necklace'){add(ac,'path',{d:'M60 120 Q90 132 120 120',stroke:'#FFD700','stroke-width':'2.5',fill:'none','stroke-linecap':'round'});add(ac,'polygon',{points:'90,128 94,136 90,144 86,136',fill:'#FF85A1'});}
  else if(type==='earrings'){[52,128].forEach(cx=>{add(ac,'circle',{cx,cy:'88',r:'4',fill:'#FFD700'});add(ac,'circle',{cx,cy:'98',r:'5',fill:'#FF85A1'});});}
  else if(type==='glasses'){add(ac,'path',{d:'M60 78 Q68 71 78 78 Q82 82 86 78 Q94 71 104 78 Q106 84 100 87 Q94 90 86 87 Q82 89 78 87 Q68 90 62 87 Q58 84 60 78 Z',fill:'none',stroke:'#9333ea','stroke-width':'2.5'});add(ac,'line',{x1:'78',y1:'80',x2:'86',y2:'80',stroke:'#9333ea','stroke-width':'2'});}
  else if(type==='wings'){add(ac,'path',{d:'M46 132 Q16 108 14 148 Q12 188 44 176 Q38 158 46 142 Z',fill:'rgba(200,230,255,0.7)',stroke:'#c4b5fd','stroke-width':'2'});add(ac,'path',{d:'M46 150 Q18 142 18 168 Q18 194 46 186 Z',fill:'rgba(200,230,255,0.5)',stroke:'#c4b5fd','stroke-width':'1.5'});add(ac,'path',{d:'M134 132 Q164 108 166 148 Q168 188 136 176 Q142 158 134 142 Z',fill:'rgba(200,230,255,0.7)',stroke:'#c4b5fd','stroke-width':'2'});add(ac,'path',{d:'M134 150 Q162 142 162 168 Q162 194 134 186 Z',fill:'rgba(200,230,255,0.5)',stroke:'#c4b5fd','stroke-width':'1.5'});}
  else if(type==='wand'){add(ac,'line',{x1:'132',y1:'170',x2:'150',y2:'122',stroke:'#8B5A2B','stroke-width':'4','stroke-linecap':'round'});const pts=[];for(let i=0;i<10;i++){const a=(i*36-90)*Math.PI/180,r=i%2===0?11:5;pts.push(`${150+r*Math.cos(a)},${118+r*Math.sin(a)}`);}add(ac,'polygon',{points:pts.join(' '),fill:'#FFD700'});}
  else if(type==='witchhat'){add(ha,'ellipse',{cx:'90',cy:'44',rx:'44',ry:'10',fill:'#1c1c1c'});add(ha,'path',{d:'M62 44 Q76 24 90 4 Q104 24 118 44 Z',fill:'#2d1b4e'});add(ha,'rect',{x:'62',y:'36',width:'56',height:'8',rx:'2',fill:'#c4b5fd'});}
  else if(type==='scarf'){add(ac,'path',{d:'M62 108 Q90 120 118 108 Q122 118 118 124 Q90 136 62 124 Q58 118 62 108 Z',fill:'#c4b5fd',stroke:'#9333ea','stroke-width':'1.5'});add(ac,'path',{d:'M72 124 Q70 148 66 162',stroke:'#c4b5fd','stroke-width':'10',fill:'none','stroke-linecap':'round'});}
  else if(type==='cape'){add(ac,'path',{d:'M58 120 Q20 160 26 230 Q58 250 90 252 Q122 250 154 230 Q160 160 122 120 Z',fill:'rgba(147,51,234,0.7)',stroke:'#7c3aed','stroke-width':'2'});}
  else if(type==='hearts'){[[56,42],[124,46]].forEach(([cx,cy])=>add(ha,'path',{d:`M${cx} ${cy+4} Q${cx-7} ${cy-4} ${cx} ${cy+1} Q${cx+7} ${cy-4} ${cx} ${cy+4} Z`,fill:'#FF85A1'}));}
  else if(type==='hat'){add(ha,'ellipse',{cx:'90',cy:'42',rx:'46',ry:'10',fill:'#8B5A2B'});add(ha,'rect',{x:'60',y:'10',width:'60',height:'34',rx:'8',fill:'#6B3A1F'});add(ha,'rect',{x:'60',y:'38',width:'60',height:'8',fill:'#FF85A1'});}
}

// Clone SVG content from dress SVG to another SVG element
function cloneCharToSvg(targetSvgId, outfit){
  const src = document.getElementById('dressSvg');
  const target = document.getElementById(targetSvgId);
  target.innerHTML = src.innerHTML;
  // Re-apply outfit to target
  if(outfit.dress) applyDressToSvg(targetSvgId, outfit.dress);
  if(outfit.hair) applyHairToSvg(targetSvgId, outfit.hair);
  if(outfit.shoes) applyShoesToSvg(targetSvgId, outfit.shoes);
  outfit.accs.forEach(a=> applyAccToSvg(targetSvgId, a));
}

function applyDressToSvg(svgId, item){
  const svg = document.getElementById(svgId);
  const skirt = svg.querySelector('[id$="Skirt"]') || svg.getElementById?.('dSkirt');
  // Use querySelectorAll with partial match
  svg.querySelectorAll('path').forEach(el=>{
    if(el.id && el.id.endsWith('Skirt')){ el.setAttribute('fill', fillOf(item.color, 'd')); el.setAttribute('d', item.skirtPath); }
  });
  svg.querySelectorAll('rect').forEach(el=>{
    if(el.id && el.id.endsWith('Torso')){ el.setAttribute('fill', fillOf(item.topColor, 'd')); }
  });
}
function applyHairToSvg(svgId, item){ /* handled by cloneCharToSvg via dressSvg state */ }
function applyShoesToSvg(svgId, item){
  const svg = document.getElementById(svgId);
  ['SL','SR'].forEach(s=>{
    svg.querySelectorAll('ellipse').forEach(el=>{
      if(el.id && el.id.endsWith(s)){ el.setAttribute('fill', item.color); }
    });
  });
}
function applyAccToSvg(svgId, item){ /* already in cloned SVG */ }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  READY & RUNWAY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function goReady(){
  stopTimer();
  if(myRole === 'solo'){
    startRunway('p1', myName, myOutfit);
    return;
  }
  // Send outfit to other player
  const outfitData = {
    dress: myOutfit.dress,
    hair: myOutfit.hair,
    shoes: myOutfit.shoes,
    accs: myOutfit.accs,
    items: myOutfit.items
  };
  send('ready', {outfit: outfitData});
  if(myRole === 'guest'){
    // Wait for host to start runway
    showScreen('runwayScreen');
    document.getElementById('runwayMsg').textContent = '‚è≥ Waiting for the show to begin‚Ä¶';
  } else {
    // Host: store outfit and wait for guest ready, or timeout
    themOutfit = outfitData; // temp until guest sends theirs
    startRunway('p1', myName, myOutfit);
  }
}

function startRunway(who, name, outfit){
  showScreen('runwayScreen');
  document.getElementById('runwayPlayerName').textContent = name + "'s Look ‚ú®";
  document.getElementById('runwayMsg').textContent = 'üéµ Walking the runway‚Ä¶';

  // Apply outfit to runway SVG
  const rSvg = document.getElementById('runwaySvg');
  const dSvg = document.getElementById('dressSvg');
  rSvg.innerHTML = dSvg.innerHTML;
  if(outfit.dress) applyDressToSvg('runwaySvg', outfit.dress);
  if(outfit.shoes) applyShoesToSvg('runwaySvg', outfit.shoes);

  // After walk animation (3s), show judge or results
  setTimeout(()=>{
    if(myRole === 'solo'){
      showJudgeScreen(name, outfit);
    } else if(myRole === 'host'){
      if(who === 'p1'){
        // Host judges their own look, guest judges too
        send('startJudge', {who:'p1', name, outfit});
        showJudgeScreen(name, outfit);
        currentJudgeFor = 'p1';
      } else {
        // Show p2's runway then judge
        send('startJudge', {who:'p2', name, outfit});
        showJudgeScreen(name, outfit);
        currentJudgeFor = 'p2';
      }
    } else {
      // Guest: show judge screen for whoever's on runway
      if(who === 'p1'){
        showJudgeScreen(name, outfit);
        currentJudgeFor = 'p1';
      } else {
        showJudgeScreen(name, outfit);
        currentJudgeFor = 'p2';
      }
    }
  }, 3500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  JUDGING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let selectedStars = 0;

function showJudgeScreen(name, outfit){
  showScreen('judgeScreen');
  document.getElementById('judgeName').textContent = name + "'s Look";
  selectedStars = 0;
  document.getElementById('submitStarsBtn').disabled = true;
  document.getElementById('starMsg').textContent = '';
  // Reset stars
  document.querySelectorAll('.star').forEach(s=> s.classList.remove('lit'));

  // Clone char to judge SVG
  const jSvg = document.getElementById('judgeSvg');
  const dSvg = document.getElementById('dressSvg');
  jSvg.innerHTML = dSvg.innerHTML;
  if(outfit && outfit.dress) applyDressToSvg('judgeSvg', outfit.dress);
  if(outfit && outfit.shoes) applyShoesToSvg('judgeSvg', outfit.shoes);

  // Tags
  const tags = document.getElementById('judgeTags');
  tags.innerHTML = '';
  const allItems = [
    outfit?.dress?.name, outfit?.hair?.name, outfit?.shoes?.name,
    ...(outfit?.accs||[]).map(a=>a.name),
    ...(outfit?.items||[])
  ].filter(Boolean);
  allItems.forEach(item=>{
    const t = document.createElement('div');
    t.className = 'jtag';
    t.textContent = item;
    tags.appendChild(t);
  });
}

function rateStar(n){
  selectedStars = n;
  document.querySelectorAll('.star').forEach((s,i)=>{
    s.classList.toggle('lit', i < n);
  });
  const msgs = ['','üò¨ Hmm‚Ä¶','üòê Not bad','üòä Pretty good!','üòç Amazing!','ü§© PERFECT! 5 Stars!'];
  document.getElementById('starMsg').textContent = msgs[n];
  document.getElementById('submitStarsBtn').disabled = false;
}

function submitStars(){
  if(!selectedStars) return;
  if(myRole === 'solo'){
    myStars = selectedStars;
    showResults();
    return;
  }

  send('stars', {stars: selectedStars, for: currentJudgeFor});

  if(myRole === 'host'){
    if(currentJudgeFor === 'p1'){
      myStars = selectedStars;
      // Now show p2's runway
      send('startRunway', {who:'p2', name:themName, outfit:themOutfit});
      startRunway('p2', themName, themOutfit);
    } else {
      themStars = selectedStars;
      showResults();
      send('showResults', {myStars, themStars});
    }
  } else {
    // Guest
    if(currentJudgeFor === 'p1'){
      // guest rated p1, wait for host to show p2
    } else {
      myStars = selectedStars;
    }
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RESULTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showResults(){
  showScreen('resultsScreen');
  const n1 = myRole === 'guest' ? themName : myName;
  const n2 = myRole === 'guest' ? myName : themName;
  const s1 = myStars;
  const s2 = themStars;

  document.getElementById('resN1').textContent = n1;
  document.getElementById('resN2').textContent = n2;
  document.getElementById('resStars1').textContent = s1;
  document.getElementById('resStars2').textContent = s2;

  let winner, trophy;
  if(s1 > s2){ winner = n1; trophy = 'üèÜ'; }
  else if(s2 > s1){ winner = n2; trophy = 'üèÜ'; }
  else { winner = 'Tie!'; trophy = 'ü§ù'; }

  document.getElementById('resTrophy').textContent = trophy;
  document.getElementById('resTitle').textContent = winner === 'Tie!' ? "It's a Tie!" : `${winner} Wins!`;
  document.getElementById('resWinner').textContent = winner === 'Tie!' ? 'üëØ Amazing styles ‚Äî too close to call!' : `üéâ Style Queen: ${winner}!`;
  document.getElementById('resReason').textContent = `${n1} got ${s1}‚≠ê ¬∑ ${n2} got ${s2}‚≠ê`;

  if(winner !== 'Tie!') confetti(60);
}

function playAgain(){
  resetGame();
  send('playAgain');
  if(myRole === 'host' || myRole === 'solo'){
    showScreen('themeScreen');
    buildThemeGrid();
  } else {
    showScreen('dressScreen');
    buildChoices(currentCat);
    applyThemeUI();
    startTimer();
  }
}

function resetGame(){
  myOutfit = {dress:null, hair:HAIRSTYLES[0], shoes:null, accs:[], items:[]};
  themOutfit = {dress:null, hair:HAIRSTYLES[0], shoes:null, accs:[], items:[]};
  myStars = 0; themStars = 0;
  selectedStars = 0;
  // Reset dress SVG
  ['dHE','dAC','dHA'].forEach(id=> document.getElementById(id).innerHTML='');
  document.getElementById('dSkirt').setAttribute('fill','#FF85A1');
  document.getElementById('dSkirt').setAttribute('d','M54 176 Q50 200 42 248 Q66 260 90 262 Q114 260 138 248 Q130 200 126 176 Z');
  document.getElementById('dTorso').setAttribute('fill','#FFB3C8');
  ['dHB','dHF'].forEach(id=>{ const el=document.getElementById(id); el.setAttribute('fill','#8B5A2B'); });
  document.getElementById('dHL').setAttribute('fill','#8B5A2B');
  document.getElementById('dHB').setAttribute('rx','44'); document.getElementById('dHB').setAttribute('ry','48'); document.getElementById('dHB').setAttribute('cy','78');
  document.getElementById('dSL').setAttribute('fill','#E8547A'); document.getElementById('dSR').setAttribute('fill','#E8547A');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TIMER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startTimer(){
  stopTimer();
  timeLeft = 180;
  updateTimer();
  timerInterval = setInterval(()=>{
    timeLeft--;
    updateTimer();
    if(timeLeft <= 0){ stopTimer(); goReady(); }
  }, 1000);
}
function stopTimer(){ clearInterval(timerInterval); timerInterval = null; }
function updateTimer(){
  const m = Math.floor(timeLeft/60);
  const s = String(timeLeft%60).padStart(2,'0');
  const box = document.getElementById('timerBox');
  box.textContent = m+':'+s;
  box.className = 'timer-box' + (timeLeft <= 30 ? ' urgent' : '');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PHASE ANNOUNCE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showPhase(emoji, name, sub){
  const ps = document.getElementById('phaseScreen');
  document.getElementById('phaseEmoji').textContent = emoji;
  document.getElementById('phaseBig').textContent = name;
  document.getElementById('phaseSub').textContent = sub || '';
  ps.classList.add('show');
  setTimeout(()=> ps.classList.remove('show'), 2800);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONFETTI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function confetti(n){
  const cols=['#FF85A1','#FFD700','#c4b5fd','#6ee7b7','#fb923c','#f472b6','#60a5fa'];
  for(let i=0;i<n;i++){
    const c=document.createElement('div');
    c.className='cf';
    c.style.left=Math.random()*100+'vw';
    c.style.top='-20px';
    c.style.background=cols[Math.floor(Math.random()*cols.length)];
    c.style.animationDelay=Math.random()*.8+'s';
    c.style.width=(7+Math.random()*9)+'px';
    c.style.height=(7+Math.random()*9)+'px';
    c.style.borderRadius=Math.random()>.5?'50%':'3px';
    document.body.appendChild(c);
    setTimeout(()=>c.remove(), 2800);
  }
}

// Init
buildThemeGrid();
</script>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</body>
</html>
